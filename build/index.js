/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var e={20:(e,t,n)=>{var s=n(594),a=Symbol.for("react.element"),i=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),r=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var s,c={},l=null,p=null;for(s in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(p=t.ref),t)i.call(t,s)&&!o.hasOwnProperty(s)&&(c[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===c[s]&&(c[s]=t[s]);return{$$typeof:a,type:e,key:l,ref:p,props:c,_owner:r.current}}t.jsx=c,t.jsxs=c},594:e=>{e.exports=React},848:(e,t,n)=>{e.exports=n(20)}},t={};function n(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}n(594);const s=wp.element;var a=n(848);const i=({eventRegistration:e,emitResponse:t,billing:n})=>{const{cartTotal:i,currency:r}=n,{onPaymentSetup:o}=e;return(0,s.useEffect)((()=>{if(window.shift4Initialised)window.shift4UpdatedCheckout();else{const e=()=>{"function"==typeof window.initShift4&&(window.initShift4(),window.shift4Initialised=!0,window.shift4UpdatedCheckout())};window.shift4JsLoaded?e():document.addEventListener("shift4JsLoaded",e)}const e=o((async()=>{window.clearError(),await window.shift4PaymentFormSubmit({amount:i.value,currency:r.code});const e=window.paymentMethodDataRef.current;return e&&Object.keys(e).length>0?{type:t.responseTypes.SUCCESS,meta:{paymentMethodData:{...window.paymentMethodDataRef.current}}}:{type:t.responseTypes.ERROR,message:"There was an error"}}));return()=>{e()}}),[t.responseTypes.ERROR,t.responseTypes.SUCCESS,o]),(0,a.jsxs)("div",{id:"shift4-payment-form",children:[(0,a.jsxs)("div",{className:"shift4-payment-field",children:[(0,a.jsx)("label",{className:"shift4-payment-number-label",children:"Card number"}),(0,a.jsx)("div",{className:"shift4-payment-input shift4-payment-number-input","data-shift4":"number"})]}),(0,a.jsxs)("div",{className:"shift4-payment-fields",children:[(0,a.jsxs)("div",{className:"shift4-payment-field",children:[(0,a.jsx)("label",{className:"shift4-payment-expiry-label",children:"Expiration"}),(0,a.jsx)("div",{className:"shift4-payment-input shift4-payment-expiry-input","data-shift4":"expiry"})]}),(0,a.jsxs)("div",{className:"shift4-payment-field",children:[(0,a.jsx)("label",{className:"shift4-payment-cvv-label",children:"Cvv"}),(0,a.jsx)("div",{className:"shift4-payment-input shift4-payment-cvv-input","data-shift4":"cvc"})]})]})]})},{useSelect:r}=window.wp.data,{validationStore:o}=window.wc.wcBlocksData,c=e=>{if(!e)return null;const{activePaymentMethod:t,billing:n,emitResponse:i,eventRegistration:c,onSubmit:l,onClose:p}=e,{onPaymentSetup:d,onCheckoutFail:u,onCheckoutSuccess:y}=c;if(!n)return null;const f=(0,s.useRef)(null),h=(0,s.useRef)(null),{cartTotal:m,currency:w}=n,v=(0,s.useRef)(null),S=r((e=>e(o).hasValidationErrors()),[o]);(0,s.useEffect)((()=>{if(!window.shift4Initialised){const e=()=>{"function"==typeof window.initShift4&&(window.initShift4(),window.shift4Initialised=!0)};window.shift4JsLoaded?e():document.addEventListener("shift4JsLoaded",e)}const e=h.current;return e&&e.addEventListener("click",b),()=>{e&&e.removeEventListener("click",b)}}),[]);const b=async()=>{l()};return(0,s.useEffect)((()=>{const e=d((async()=>{v.current=await(async()=>{if(!m.value)return null;const e=await window.shift4PayWithApplePay({value:(m.value/Math.pow(10,w.minorUnit)).toFixed(w.minorUnit),currency:w.code});return f.current&&(f.current.value=JSON.stringify(e.details.token.paymentData)),e})();try{if(f.current?.value)return{type:i.responseTypes.SUCCESS,meta:{paymentMethodData:{shift4_applepay_token:f.current.value}}}}catch(e){const t=e instanceof Error?e:new Error("An unknown error occurred while processing the payment.");return p(),v.current&&v.current.complete("fail"),{type:i.responseTypes.ERROR,message:t.message||"An error occurred while processing the payment."}}})),t=y((async()=>{v.current&&await v.current.complete("success")})),n=u((async()=>{v.current&&await v.current.complete("fail")}));return()=>{t(),n(),e()}}),[u,y,d,i.responseTypes.ERROR,i.responseTypes.SUCCESS,p]),(0,s.useEffect)((()=>{const e=document.querySelector("button.wc-block-components-checkout-place-order-button");return"shift4_applepay"===t?e?.style.setProperty("display","none","important"):e?.style.removeProperty("display"),()=>{e&&e.style.removeProperty("display")}}),[t]),(0,a.jsxs)("div",{style:S?{opacity:.2,pointerEvents:"none"}:void 0,children:[(0,a.jsx)("apple-pay-button",{id:"apple-pay-submit-button",buttonstyle:"black",type:"buy",locale:"en-US",class:"w-full",lang:"en-US",ref:h}),(0,a.jsx)("input",{type:"hidden",name:"shift4_applepay_token",ref:f})]})},{registerPaymentMethod:l}=window.wc.wcBlocksRegistry,{savedCardsEnabled:p}=window.shift4CardSettings;l({name:"shift4_applepay",label:window.shift4ApplePaySettings.applePayTitle,edit:(0,a.jsx)("p",{children:"Apple Pay (Shift4)"}),content:(0,a.jsx)(c,{}),ariaLabel:"Apple Pay payment method",canMakePayment:()=>!!(window.ApplePaySession&&window.ApplePaySession.canMakePayments()&&window.shift4ApplePaySettings.enabled)}),l({name:"shift4_card",label:window.shift4CardSettings.cardTitle,content:(0,a.jsx)(i,{}),edit:(0,a.jsx)("p",{children:"Credit Card (Shift4)'"}),canMakePayment:()=>window.shift4CardSettings.enabled,ariaLabel:"Shift4 Credit Card payment method",supports:{features:["products"],showSavedCards:"yes"===p,showSaveOption:"yes"===p}})})();